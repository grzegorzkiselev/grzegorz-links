import{AnimationClip as ot,Bone as at,Box3 as it,BufferAttribute as _e,BufferGeometry as ut,CanvasTexture as lt,ClampToEdgeWrapping as ct,Color as b,DirectionalLight as pt,DoubleSide as ht,FileLoader as Le,FrontSide as dt,Group as se,ImageBitmapLoader as ft,InterleavedBuffer as Tt,InterleavedBufferAttribute as gt,Interpolant as Ae,InterpolateDiscrete as vt,InterpolateLinear as Re,Line as St,LineBasicMaterial as mt,LineLoop as Et,LineSegments as _t,LinearFilter as Me,LinearMipmapLinearFilter as ye,LinearMipmapNearestFilter as Lt,Loader as xe,LoaderUtils as B,Material as we,MathUtils as At,Matrix4 as be,Mesh as Rt,MeshBasicMaterial as D,MeshPhysicalMaterial as Oe,MeshStandardMaterial as k,MirroredRepeatWrapping as Mt,NearestFilter as yt,NearestMipmapLinearFilter as xt,NearestMipmapNearestFilter as wt,NumberKeyframeTrack as bt,Object3D as Ot,OrthographicCamera as Nt,PerspectiveCamera as Ct,PointLight as Ft,Points as It,PointsMaterial as Ut,PropertyBinding as Gt,QuaternionKeyframeTrack as Ht,RGBFormat as Pt,RepeatWrapping as oe,Skeleton as Bt,SkinnedMesh as Dt,Sphere as kt,SpotLight as Kt,TangentSpaceNormalMap as jt,TextureLoader as Vt,TriangleFanDrawMode as Ne,TriangleStripDrawMode as Xt,Vector2 as Ce,Vector3 as X,VectorKeyframeTrack as Wt,sRGBEncoding as Fe}from"./three.min.js";var qt=function(){function W(e){xe.call(this,e),this.dracoLoader=null,this.ddsLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new z(t)}),this.register(function(t){return new ae(t)}),this.register(function(t){return new Q(t)}),this.register(function(t){return new Y(t)}),this.register(function(t){return new K(t)}),this.register(function(t){return new ie(t)})}function Ie(){var e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}W.prototype=Object.assign(Object.create(xe.prototype),{constructor:W,load:function(e,t,r,n){var s=this,o;o=this.resourcePath!==""?this.resourcePath:this.path!==""?this.path:B.extractUrlBase(e),this.manager.itemStart(e);var i=function(u){n?n(u):console.error(u),s.manager.itemError(e),s.manager.itemEnd(e)},a=new Le(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(u){try{s.parse(u,o,function(l){t(l),s.manager.itemEnd(e)},i)}catch(l){i(l)}},r,i)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},setKTX2Loader:function(e){return this.ktx2Loader=e,this},setMeshoptDecoder:function(e){return this.meshoptDecoder=e,this},register:function(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this},unregister:function(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this},parse:function(e,t,r,n){var s,o={},i={},a;if(typeof e=="string")s=e;else if(B.decodeText(new Uint8Array(e,0,4))===ue){try{o[T.KHR_BINARY_GLTF]=new Pe(e)}catch(d){return void(n&&n(d))}s=o[T.KHR_BINARY_GLTF].content}else s=B.decodeText(new Uint8Array(e));var u=JSON.parse(s);if(u.asset===void 0||u.asset.version[0]<2)n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var l=new S(u,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(var c=0;c<this.pluginCallbacks.length;c++){var p=this.pluginCallbacks[c](l);i[p.name]=p,o[p.name]=!0}if(u.extensionsUsed)for(var c=0;c<u.extensionsUsed.length;++c){var h=u.extensionsUsed[c],f=u.extensionsRequired||[];switch(h){case T.KHR_MATERIALS_UNLIT:o[h]=new q;break;case T.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[h]=new Be;break;case T.KHR_DRACO_MESH_COMPRESSION:o[h]=new le(u,this.dracoLoader);break;case T.MSFT_TEXTURE_DDS:o[h]=new Ue(this.ddsLoader);break;case T.KHR_TEXTURE_TRANSFORM:o[h]=new ce;break;case T.KHR_MESH_QUANTIZATION:o[h]=new De;break;default:f.indexOf(h)>=0&&i[h]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}l.setExtensions(o),l.setPlugins(i),l.parse(r,n)}}});var T={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function Ue(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=T.MSFT_TEXTURE_DDS,this.ddsLoader=e}function K(e){this.parser=e,this.name=T.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}function q(){this.name=T.KHR_MATERIALS_UNLIT}function z(e){this.parser=e,this.name=T.KHR_MATERIALS_CLEARCOAT}function Y(e){this.parser=e,this.name=T.KHR_MATERIALS_TRANSMISSION}function ae(e){this.parser=e,this.name=T.KHR_TEXTURE_BASISU}function Q(e){this.parser=e,this.name=T.EXT_TEXTURE_WEBP,this.isSupported=null}function ie(e){this.name=T.EXT_MESHOPT_COMPRESSION,this.parser=e}K.prototype._markDefs=function(){for(var e=this.parser,t=this.parser.json.nodes||[],r=0,n=t.length;r<n;r++){var s=t[r];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}},K.prototype._loadLight=function(e){var t=this.parser,r="light:"+e,n=t.cache.get(r);if(n)return n;var s=t.json,o,i,a=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e],u,l=new b(16777215);a.color!==void 0&&l.fromArray(a.color);var c=a.range!==void 0?a.range:0;switch(a.type){case"directional":(u=new pt(l)).target.position.set(0,0,-1),u.add(u.target);break;case"point":(u=new Ft(l)).distance=c;break;case"spot":(u=new Kt(l)).distance=c,a.spot=a.spot||{},a.spot.innerConeAngle=a.spot.innerConeAngle!==void 0?a.spot.innerConeAngle:0,a.spot.outerConeAngle=a.spot.outerConeAngle!==void 0?a.spot.outerConeAngle:Math.PI/4,u.angle=a.spot.outerConeAngle,u.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return u.position.set(0,0,0),u.decay=2,a.intensity!==void 0&&(u.intensity=a.intensity),u.name=t.createUniqueName(a.name||"light_"+e),n=Promise.resolve(u),t.cache.add(r,n),n},K.prototype.createNodeAttachment=function(e){var t=this,r=this.parser,n,s=r.json.nodes[e],o,i=(s.extensions&&s.extensions[this.name]||{}).light;return i===void 0?null:this._loadLight(i).then(function(a){return r._getNodeRef(t.cache,i,a)})},q.prototype.getMaterialType=function(){return D},q.prototype.extendParams=function(e,t,r){var n=[];e.color=new b(1,1,1),e.opacity=1;var s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){var o=s.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}s.baseColorTexture!==void 0&&n.push(r.assignTexture(e,"map",s.baseColorTexture))}return Promise.all(n)},z.prototype.getMaterialType=function(e){var t,r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?Oe:null},z.prototype.extendMaterialParams=function(e,t){var r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();var s=[],o=n.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&s.push(r.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&s.push(r.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(s.push(r.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){var i=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Ce(i,i)}return Promise.all(s)},Y.prototype.getMaterialType=function(e){var t,r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?Oe:null},Y.prototype.extendMaterialParams=function(e,t){var r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();var s=[],o=n.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&s.push(r.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(s)},ae.prototype.loadTexture=function(e){var t=this.parser,r=t.json,n=r.textures[e];if(!n.extensions||!n.extensions[this.name])return null;var s=n.extensions[this.name],o=r.images[s.source],i=t.options.ktx2Loader;if(!i){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o,i)},Q.prototype.loadTexture=function(e){var t=this.name,r=this.parser,n=r.json,s=n.textures[e];if(!s.extensions||!s.extensions[t])return null;var o=s.extensions[t],i=n.images[o.source],a=i.uri?r.options.manager.getHandler(i.uri):r.textureLoader;return this.detectSupport().then(function(u){if(u)return r.loadTextureImage(e,i,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)})},Q.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise(function(e){var t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported},ie.prototype.loadBufferView=function(e){var t=this.parser.json,r=t.bufferViews[e];if(r.extensions&&r.extensions[this.name]){var n=r.extensions[this.name],s=this.parser.getDependency("buffer",n.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([s,o.ready]).then(function(i){var a=n.byteOffset||0,u=n.byteLength||0,l=n.count,c=n.byteStride,p=new ArrayBuffer(l*c),h=new Uint8Array(i[0],a,u);return o.decodeGltfBuffer(new Uint8Array(p),l,c,h,n.mode,n.filter),p})}return null};var ue="glTF",zt=12,Ge=1313821514,He=5130562;function Pe(e){this.name=T.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,12);if(this.header={magic:B.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==ue)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var r=new DataView(e,12),n=0;n<r.byteLength;){var s=r.getUint32(n,!0);n+=4;var o=r.getUint32(n,!0);if(n+=4,o===Ge){var i=new Uint8Array(e,12+n,s);this.content=B.decodeText(i)}else if(o===He){var a=12+n;this.body=e.slice(a,a+s)}n+=s}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}function le(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=T.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function ce(){this.name=T.KHR_TEXTURE_TRANSFORM}function O(e){k.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),r=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),n=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	texelSpecular = sRGBToLinear( texelSpecular );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),i={specular:{value:new b().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=i,this.onBeforeCompile=function(a){for(var u in i)a.uniforms[u]=i[u];a.fragmentShader=a.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",r).replace("#include <roughnessmap_fragment>",n).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return i.specular.value},set:function(a){i.specular.value=a}},specularMap:{get:function(){return i.specularMap.value},set:function(a){i.specularMap.value=a,a?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return i.glossiness.value},set:function(a){i.glossiness.value=a}},glossinessMap:{get:function(){return i.glossinessMap.value},set:function(a){i.glossinessMap.value=a,a?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function Be(){return{name:T.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return O},extendParams:function(e,t,r){var n=t.extensions[this.name];e.color=new b(1,1,1),e.opacity=1;var s=[];if(Array.isArray(n.diffuseFactor)){var o=n.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(n.diffuseTexture!==void 0&&s.push(r.assignTexture(e,"map",n.diffuseTexture)),e.emissive=new b(0,0,0),e.glossiness=n.glossinessFactor!==void 0?n.glossinessFactor:1,e.specular=new b(1,1,1),Array.isArray(n.specularFactor)&&e.specular.fromArray(n.specularFactor),n.specularGlossinessTexture!==void 0){var i=n.specularGlossinessTexture;s.push(r.assignTexture(e,"glossinessMap",i)),s.push(r.assignTexture(e,"specularMap",i))}return Promise.all(s)},createMaterial:function(e){var t=new O(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=jt,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}}function De(){this.name=T.KHR_MESH_QUANTIZATION}function R(e,t,r,n){Ae.call(this,e,t,r,n)}le.prototype.decodePrimitive=function(e,t){var r=this.json,n=this.dracoLoader,s=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,i={},a={},u={};for(var l in o){var c=Z[l]||l.toLowerCase();i[c]=o[l]}for(l in e.attributes){var c=Z[l]||l.toLowerCase();if(o[l]!==void 0){var p=r.accessors[e.attributes[l]],h=J[p.componentType];u[c]=h,a[c]=p.normalized===!0}}return t.getDependency("bufferView",s).then(function(f){return new Promise(function(d){n.decodeDracoFile(f,function(v){for(var E in v.attributes){var m=v.attributes[E],g=a[E];g!==void 0&&(m.normalized=g)}d(v)},i,u)})})},ce.prototype.extendTexture=function(e,t){return e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},O.prototype=Object.create(k.prototype),O.prototype.constructor=O,O.prototype.copy=function(e){return k.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},R.prototype=Object.create(Ae.prototype),R.prototype.constructor=R,R.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,s=e*n*3+n,o=0;o!==n;o++)t[o]=r[s+o];return t},R.prototype.beforeStart_=R.prototype.copySampleValue_,R.prototype.afterEnd_=R.prototype.copySampleValue_,R.prototype.interpolate_=function(e,t,r,n){for(var s=this.resultBuffer,o=this.sampleValues,i=this.valueSize,a=2*i,u=3*i,l=n-t,c=(r-t)/l,p=c*c,h=p*c,f=e*u,d=f-u,v=-2*h+3*p,E=h-p,m=1-v,g=E-p+c,_=0;_!==i;_++){var x=o[d+_+i],G=o[d+_+a]*l,F=o[f+_+i],A=o[f+_]*l;s[_]=m*x+g*G+v*F+E*A}return s};var Yt=5126,Qt=35675,Jt=35676,Zt=35664,$t=35665,en=35666,tn=9729,nn=10497,rn=35678,ke=0,Ke=1,je=2,Ve=3,Xe=4,pe=5,he=6,sn=5121,on=5123,J={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},de={9728:yt,9729:Me,9984:wt,9985:Lt,9986:xt,9987:ye},fe={33071:ct,33648:Mt,10497:oe},Te={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Z={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},y={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},We={CUBICSPLINE:void 0,LINEAR:Re,STEP:vt},qe="OPAQUE",ze="MASK",Ye="BLEND";function ge(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function Qe(e){return e.DefaultMaterial===void 0&&(e.DefaultMaterial=new k({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:dt})),e.DefaultMaterial}function U(e,t,r){for(var n in r.extensions)e[n]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=r.extensions[n])}function N(e,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function Je(e,t,r){for(var n=!1,s=!1,o=0,i=t.length;o<i;o++){var a;if((a=t[o]).POSITION!==void 0&&(n=!0),a.NORMAL!==void 0&&(s=!0),n&&s)break}if(!n&&!s)return Promise.resolve(e);for(var u=[],l=[],o=0,i=t.length;o<i;o++){var a=t[o];if(n){var c=a.POSITION!==void 0?r.getDependency("accessor",a.POSITION):e.attributes.position;u.push(c)}if(s){var c=a.NORMAL!==void 0?r.getDependency("accessor",a.NORMAL):e.attributes.normal;l.push(c)}}return Promise.all([Promise.all(u),Promise.all(l)]).then(function(p){var h=p[0],f=p[1];return n&&(e.morphAttributes.position=h),s&&(e.morphAttributes.normal=f),e.morphTargetsRelative=!0,e})}function Ze(e,t){if(e.updateMorphTargets(),t.weights!==void 0)for(var r=0,n=t.weights.length;r<n;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){var s=t.extras.targetNames;if(e.morphTargetInfluences.length===s.length){e.morphTargetDictionary={};for(var r=0,n=s.length;r<n;r++)e.morphTargetDictionary[s[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function $e(e){var t=e.extensions&&e.extensions[T.KHR_DRACO_MESH_COMPRESSION],r;return r=t?"draco:"+t.bufferView+":"+t.indices+":"+ve(t.attributes):e.indices+":"+ve(e.attributes)+":"+e.mode}function ve(e){for(var t="",r=Object.keys(e).sort(),n=0,s=r.length;n<s;n++)t+=r[n]+":"+e[r[n]]+";";return t}function S(e,t){this.json=e||{},this.extensions={},this.plugins={},this.options=t||{},this.cache=new Ie,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},typeof createImageBitmap<"u"&&/Firefox/.test(navigator.userAgent)===!1?this.textureLoader=new ft(this.options.manager):this.textureLoader=new Vt(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new Le(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}function et(e,t,r){var n=t.attributes,s=new it;if(n.POSITION!==void 0){var o,i=(o=r.json.accessors[n.POSITION]).min,a=o.max;if(i!==void 0&&a!==void 0){s.set(new X(i[0],i[1],i[2]),new X(a[0],a[1],a[2]));var u=t.targets;if(u!==void 0){for(var l=new X,c=new X,p=0,h=u.length;p<h;p++){var f=u[p];if(f.POSITION!==void 0){var o,i=(o=r.json.accessors[f.POSITION]).min,a=o.max;i!==void 0&&a!==void 0?(c.setX(Math.max(Math.abs(i[0]),Math.abs(a[0]))),c.setY(Math.max(Math.abs(i[1]),Math.abs(a[1]))),c.setZ(Math.max(Math.abs(i[2]),Math.abs(a[2]))),l.max(c)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(l)}e.boundingBox=s;var d=new kt;s.getCenter(d.center),d.radius=s.min.distanceTo(s.max)/2,e.boundingSphere=d}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}function Se(e,t,r){var n=t.attributes,s=[];function o(l,c){return r.getDependency("accessor",l).then(function(p){e.setAttribute(c,p)})}for(var i in n){var a=Z[i]||i.toLowerCase();a in e.attributes||s.push(o(n[i],a))}if(t.indices!==void 0&&!e.index){var u=r.getDependency("accessor",t.indices).then(function(l){e.setIndex(l)});s.push(u)}return N(e,t),et(e,t,r),Promise.all(s).then(function(){return t.targets!==void 0?Je(e,t.targets,r):e})}function me(e,t){var r=e.getIndex();if(r===null){var n=[],s=e.getAttribute("position");if(s===void 0)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var o=0;o<s.count;o++)n.push(o);e.setIndex(n),r=e.getIndex()}var i=r.count-2,a=[];if(t===Ne)for(var o=1;o<=i;o++)a.push(r.getX(0)),a.push(r.getX(o)),a.push(r.getX(o+1));else for(var o=0;o<i;o++)o%2==0?(a.push(r.getX(o)),a.push(r.getX(o+1)),a.push(r.getX(o+2))):(a.push(r.getX(o+2)),a.push(r.getX(o+1)),a.push(r.getX(o)));a.length/3!==i&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var u=e.clone();return u.setIndex(a),u}return S.prototype.setExtensions=function(e){this.extensions=e},S.prototype.setPlugins=function(e){this.plugins=e},S.prototype.parse=function(e,t){var r=this,n=this.json,s=this.extensions;this.cache.removeAll(),this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(o){var i={scene:o[0][n.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:n.asset,parser:r,userData:{}};U(s,i,n),N(i,n),e(i)}).catch(t)},S.prototype._markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[],n=0,s=t.length;n<s;n++)for(var o=t[n].joints,i=0,a=o.length;i<a;i++)e[o[i]].isBone=!0;for(var u=0,l=e.length;u<l;u++){var c=e[u];c.mesh!==void 0&&(this._addNodeRef(this.meshCache,c.mesh),c.skin!==void 0&&(r[c.mesh].isSkinnedMesh=!0)),c.camera!==void 0&&this._addNodeRef(this.cameraCache,c.camera)}},S.prototype._addNodeRef=function(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)},S.prototype._getNodeRef=function(e,t,r){if(e.refs[t]<=1)return r;var n=r.clone();return n.name+="_instance_"+e.uses[t]++,n},S.prototype._invokeOne=function(e){var t=Object.values(this.plugins);t.push(this);for(var r=0;r<t.length;r++){var n=e(t[r]);if(n)return n}},S.prototype._invokeAll=function(e){var t=Object.values(this.plugins);t.unshift(this);for(var r=[],n=0;n<t.length;n++){var s=e(t[n]);s&&r.push(s)}return r},S.prototype.getDependency=function(e,t){var r=e+":"+t,n=this.cache.get(r);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this.loadNode(t);break;case"mesh":n=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this.loadAnimation(t);break;case"camera":n=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,n)}return n},S.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var r=this,n=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(n.map(function(s,o){return r.getDependency(e,o)})),this.cache.add(e,t)}return t},S.prototype.loadBuffer=function(e){var t=this.json.buffers[e],r=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[T.KHR_BINARY_GLTF].body);var n=this.options;return new Promise(function(s,o){r.load(ge(t.uri,n.path),s,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})},S.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(r){var n=t.byteLength||0,s=t.byteOffset||0;return r.slice(s,s+n)})},S.prototype.loadAccessor=function(e){var t=this,r=this.json,n=this.json.accessors[e];if(n.bufferView===void 0&&n.sparse===void 0)return Promise.resolve(null);var s=[];return n.bufferView!==void 0?s.push(this.getDependency("bufferView",n.bufferView)):s.push(null),n.sparse!==void 0&&(s.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(s).then(function(o){var i=o[0],a=Te[n.type],u=J[n.componentType],l=u.BYTES_PER_ELEMENT,c=l*a,p=n.byteOffset||0,h=n.bufferView!==void 0?r.bufferViews[n.bufferView].byteStride:void 0,f=n.normalized===!0,d,v;if(h&&h!==c){var E=Math.floor(p/h),m="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+E+":"+n.count,g=t.cache.get(m);g||(d=new u(i,E*h,n.count*h/l),g=new Tt(d,h/l),t.cache.add(m,g)),v=new gt(g,a,p%h/l,f)}else d=i===null?new u(n.count*a):new u(i,p,n.count*a),v=new _e(d,a,f);if(n.sparse!==void 0){var _=Te.SCALAR,x=J[n.sparse.indices.componentType],G=n.sparse.indices.byteOffset||0,F=n.sparse.values.byteOffset||0,A=new x(o[1],G,n.sparse.count*_),I=new u(o[2],F,n.sparse.count*a);i!==null&&(v=new _e(v.array.slice(),v.itemSize,v.normalized));for(var L=0,$=A.length;L<$;L++){var C=A[L];if(v.setX(C,I[L*a]),a>=2&&v.setY(C,I[L*a+1]),a>=3&&v.setZ(C,I[L*a+2]),a>=4&&v.setW(C,I[L*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return v})},S.prototype.loadTexture=function(e){var t=this,r=this.json,n=this.options,s=r.textures[e],o=s.extensions||{},i,a;return(i=o[T.MSFT_TEXTURE_DDS]?r.images[o[T.MSFT_TEXTURE_DDS].source]:r.images[s.source]).uri&&(a=n.manager.getHandler(i.uri)),a||(a=o[T.MSFT_TEXTURE_DDS]?this.extensions[T.MSFT_TEXTURE_DDS].ddsLoader:this.textureLoader),this.loadTextureImage(e,i,a)},S.prototype.loadTextureImage=function(e,t,r){var n=this,s=this.json,o=this.options,i=s.textures[e],a=self.URL||self.webkitURL,u=t.uri,l=!1,c=!0;return t.mimeType==="image/jpeg"&&(c=!1),t.bufferView!==void 0&&(u=n.getDependency("bufferView",t.bufferView).then(function(p){if(t.mimeType==="image/png"){var h=new DataView(p,25,1).getUint8(0,!1);c=h===6||h===4||h===3}l=!0;var f=new Blob([p],{type:t.mimeType});return u=a.createObjectURL(f)})),Promise.resolve(u).then(function(p){return new Promise(function(h,f){var d=h;r.isImageBitmapLoader===!0&&(d=function(v){h(new lt(v))}),r.load(ge(p,o.path),d,void 0,f)})}).then(function(p){l===!0&&a.revokeObjectURL(u),p.flipY=!1,i.name&&(p.name=i.name),c||(p.format=Pt);var h,f=(s.samplers||{})[i.sampler]||{};return p.magFilter=de[f.magFilter]||Me,p.minFilter=de[f.minFilter]||ye,p.wrapS=fe[f.wrapS]||oe,p.wrapT=fe[f.wrapT]||oe,n.associations.set(p,{type:"textures",index:e}),p})},S.prototype.assignTexture=function(e,t,r){var n=this;return this.getDependency("texture",r.index).then(function(s){if(r.texCoord===void 0||r.texCoord==0||t==="aoMap"&&r.texCoord==1||console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+t+" not yet supported."),n.extensions[T.KHR_TEXTURE_TRANSFORM]){var o=r.extensions!==void 0?r.extensions[T.KHR_TEXTURE_TRANSFORM]:void 0;if(o){var i=n.associations.get(s);s=n.extensions[T.KHR_TEXTURE_TRANSFORM].extendTexture(s,o),n.associations.set(s,i)}}e[t]=s})},S.prototype.assignFinalMaterial=function(e){var t=e.geometry,r=e.material,n=t.attributes.tangent!==void 0,s=t.attributes.color!==void 0,o=t.attributes.normal===void 0,i=e.isSkinnedMesh===!0,a=Object.keys(t.morphAttributes).length>0,u=a&&t.morphAttributes.normal!==void 0;if(e.isPoints){var l="PointsMaterial:"+r.uuid,c=this.cache.get(l);c||(c=new Ut,we.prototype.copy.call(c,r),c.color.copy(r.color),c.map=r.map,c.sizeAttenuation=!1,this.cache.add(l,c)),r=c}else if(e.isLine){var l="LineBasicMaterial:"+r.uuid,p=this.cache.get(l);p||(p=new mt,we.prototype.copy.call(p,r),p.color.copy(r.color),this.cache.add(l,p)),r=p}if(n||s||o||i||a){var l="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(l+="specular-glossiness:"),i&&(l+="skinning:"),n&&(l+="vertex-tangents:"),s&&(l+="vertex-colors:"),o&&(l+="flat-shading:"),a&&(l+="morph-targets:"),u&&(l+="morph-normals:");var h=this.cache.get(l);h||(h=r.clone(),i&&(h.skinning=!0),n&&(h.vertexTangents=!0),s&&(h.vertexColors=!0),o&&(h.flatShading=!0),a&&(h.morphTargets=!0),u&&(h.morphNormals=!0),this.cache.add(l,h),this.associations.set(h,this.associations.get(r))),r=h}r.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),r.normalScale&&!n&&(r.normalScale.y=-r.normalScale.y),r.clearcoatNormalScale&&!n&&(r.clearcoatNormalScale.y=-r.clearcoatNormalScale.y),e.material=r},S.prototype.getMaterialType=function(){return k},S.prototype.loadMaterial=function(e){var t=this,r=this.json,n=this.extensions,s=r.materials[e],o,i={},a=s.extensions||{},u=[];if(a[T.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var l=n[T.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];o=l.getMaterialType(),u.push(l.extendParams(i,s,t))}else if(a[T.KHR_MATERIALS_UNLIT]){var c=n[T.KHR_MATERIALS_UNLIT];o=c.getMaterialType(),u.push(c.extendParams(i,s,t))}else{var p=s.pbrMetallicRoughness||{};if(i.color=new b(1,1,1),i.opacity=1,Array.isArray(p.baseColorFactor)){var h=p.baseColorFactor;i.color.fromArray(h),i.opacity=h[3]}p.baseColorTexture!==void 0&&u.push(t.assignTexture(i,"map",p.baseColorTexture)),i.metalness=p.metallicFactor!==void 0?p.metallicFactor:1,i.roughness=p.roughnessFactor!==void 0?p.roughnessFactor:1,p.metallicRoughnessTexture!==void 0&&(u.push(t.assignTexture(i,"metalnessMap",p.metallicRoughnessTexture)),u.push(t.assignTexture(i,"roughnessMap",p.metallicRoughnessTexture))),o=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(e)}),u.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(e,i)})))}s.doubleSided===!0&&(i.side=ht);var f=s.alphaMode||qe;return f===Ye?(i.transparent=!0,i.depthWrite=!1):(i.transparent=!1,f===ze&&(i.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&o!==D&&(u.push(t.assignTexture(i,"normalMap",s.normalTexture)),i.normalScale=new Ce(1,1),s.normalTexture.scale!==void 0&&i.normalScale.set(s.normalTexture.scale,s.normalTexture.scale)),s.occlusionTexture!==void 0&&o!==D&&(u.push(t.assignTexture(i,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(i.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&o!==D&&(i.emissive=new b().fromArray(s.emissiveFactor)),s.emissiveTexture!==void 0&&o!==D&&u.push(t.assignTexture(i,"emissiveMap",s.emissiveTexture)),Promise.all(u).then(function(){var d;return d=o===O?n[T.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(i):new o(i),s.name&&(d.name=s.name),d.map&&(d.map.encoding=Fe),d.emissiveMap&&(d.emissiveMap.encoding=Fe),N(d,s),t.associations.set(d,{type:"materials",index:e}),s.extensions&&U(n,d,s),d})},S.prototype.createUniqueName=function(e){for(var t=Gt.sanitizeNodeName(e||""),r=t,n=1;this.nodeNamesUsed[r];++n)r=t+"_"+n;return this.nodeNamesUsed[r]=!0,r},S.prototype.loadGeometries=function(e){var t=this,r=this.extensions,n=this.primitiveCache;function s(h){return r[T.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(h,t).then(function(f){return Se(f,h,t)})}for(var o=[],i=0,a=e.length;i<a;i++){var u=e[i],l=$e(u),c=n[l],p;c?o.push(c.promise):(p=u.extensions&&u.extensions[T.KHR_DRACO_MESH_COMPRESSION]?s(u):Se(new ut,u,t),n[l]={primitive:u,promise:p},o.push(p))}return Promise.all(o)},S.prototype.loadMesh=function(e){for(var t=this,r=this.json,n=this.extensions,s=r.meshes[e],o=s.primitives,i=[],a=0,u=o.length;a<u;a++){var l=o[a].material===void 0?Qe(this.cache):this.getDependency("material",o[a].material);i.push(l)}return i.push(t.loadGeometries(o)),Promise.all(i).then(function(c){for(var p=c.slice(0,c.length-1),h=c[c.length-1],f=[],d=0,v=h.length;d<v;d++){var E=h[d],m=o[d],g,_=p[d];if(m.mode===Xe||m.mode===pe||m.mode===he||m.mode===void 0)(g=s.isSkinnedMesh===!0?new Dt(E,_):new Rt(E,_)).isSkinnedMesh!==!0||g.geometry.attributes.skinWeight.normalized||g.normalizeSkinWeights(),m.mode===pe?g.geometry=me(g.geometry,Xt):m.mode===he&&(g.geometry=me(g.geometry,Ne));else if(m.mode===Ke)g=new _t(E,_);else if(m.mode===Ve)g=new St(E,_);else if(m.mode===je)g=new Et(E,_);else{if(m.mode!==ke)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);g=new It(E,_)}Object.keys(g.geometry.morphAttributes).length>0&&Ze(g,s),g.name=t.createUniqueName(s.name||"mesh_"+e),N(g,s),m.extensions&&U(n,g,m),t.assignFinalMaterial(g),f.push(g)}if(f.length===1)return f[0];for(var x=new se,d=0,v=f.length;d<v;d++)x.add(f[d]);return x})},S.prototype.loadCamera=function(e){var t,r=this.json.cameras[e],n=r[r.type];if(n)return r.type==="perspective"?t=new Ct(At.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):r.type==="orthographic"&&(t=new Nt(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),N(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},S.prototype.loadSkin=function(e){var t=this.json.skins[e],r={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then(function(n){return r.inverseBindMatrices=n,r})},S.prototype.loadAnimation=function(e){for(var t,r=this.json.animations[e],n=[],s=[],o=[],i=[],a=[],u=0,l=r.channels.length;u<l;u++){var c=r.channels[u],p=r.samplers[c.sampler],h=c.target,f=h.node!==void 0?h.node:h.id,d=r.parameters!==void 0?r.parameters[p.input]:p.input,v=r.parameters!==void 0?r.parameters[p.output]:p.output;n.push(this.getDependency("node",f)),s.push(this.getDependency("accessor",d)),o.push(this.getDependency("accessor",v)),i.push(p),a.push(h)}return Promise.all([Promise.all(n),Promise.all(s),Promise.all(o),Promise.all(i),Promise.all(a)]).then(function(E){for(var m=E[0],g=E[1],_=E[2],x=E[3],G=E[4],F=[],A=0,I=m.length;A<I;A++){var L=m[A],$=g[A],C=_[A],ee=x[A],te=G[A];if(L!==void 0){var j;switch(L.updateMatrix(),L.matrixAutoUpdate=!0,y[te.path]){case y.weights:j=bt;break;case y.rotation:j=Ht;break;case y.position:case y.scale:default:j=Wt}var tt=L.name?L.name:L.uuid,nt=ee.interpolation!==void 0?We[ee.interpolation]:Re,V=[];y[te.path]===y.weights?L.traverse(function(P){P.isMesh===!0&&P.morphTargetInfluences&&V.push(P.name?P.name:P.uuid)}):V.push(tt);var M=C.array;if(C.normalized){var H;if(M.constructor===Int8Array)H=1/127;else if(M.constructor===Uint8Array)H=1/255;else if(M.constructor==Int16Array)H=1/32767;else{if(M.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");H=1/65535}for(var Ee=new Float32Array(M.length),w=0,ne=M.length;w<ne;w++)Ee[w]=M[w]*H;M=Ee}for(var w=0,ne=V.length;w<ne;w++){var re=new j(V[w]+"."+y[te.path],$.array,M,nt);ee.interpolation==="CUBICSPLINE"&&(re.createInterpolant=function(st){return new R(this.times,this.values,this.getValueSize()/3,st)},re.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),F.push(re)}}}var rt=r.name?r.name:"animation_"+e;return new ot(rt,void 0,F)})},S.prototype.loadNode=function(e){var t=this.json,r=this.extensions,n=this,s=t.nodes[e],o=s.name?n.createUniqueName(s.name):"",i;return(i=[],s.mesh!==void 0&&i.push(n.getDependency("mesh",s.mesh).then(function(a){var u=n._getNodeRef(n.meshCache,s.mesh,a);return s.weights!==void 0&&u.traverse(function(l){if(l.isMesh)for(var c=0,p=s.weights.length;c<p;c++)l.morphTargetInfluences[c]=s.weights[c]}),u})),s.camera!==void 0&&i.push(n.getDependency("camera",s.camera).then(function(a){return n._getNodeRef(n.cameraCache,s.camera,a)})),n._invokeAll(function(a){return a.createNodeAttachment&&a.createNodeAttachment(e)}).forEach(function(a){i.push(a)}),Promise.all(i)).then(function(a){var u;if((u=s.isBone===!0?new at:a.length>1?new se:a.length===1?a[0]:new Ot)!==a[0])for(var l=0,c=a.length;l<c;l++)u.add(a[l]);if(s.name&&(u.userData.name=s.name,u.name=o),N(u,s),s.extensions&&U(r,u,s),s.matrix!==void 0){var p=new be;p.fromArray(s.matrix),u.applyMatrix4(p)}else s.translation!==void 0&&u.position.fromArray(s.translation),s.rotation!==void 0&&u.quaternion.fromArray(s.rotation),s.scale!==void 0&&u.scale.fromArray(s.scale);return n.associations.set(u,{type:"nodes",index:e}),u})},S.prototype.loadScene=function(){function e(t,r,n,s){var o=n.nodes[t];return s.getDependency("node",t).then(function(i){return o.skin===void 0?i:s.getDependency("skin",o.skin).then(function(u){for(var l=[],c=0,p=(a=u).joints.length;c<p;c++)l.push(s.getDependency("node",a.joints[c]));return Promise.all(l)}).then(function(u){return i.traverse(function(l){if(l.isMesh){for(var c=[],p=[],h=0,f=u.length;h<f;h++){var d=u[h];if(d){c.push(d);var v=new be;a.inverseBindMatrices!==void 0&&v.fromArray(a.inverseBindMatrices.array,16*h),p.push(v)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',a.joints[h])}l.bind(new Bt(c,p),l.matrixWorld)}}),i});var a}).then(function(i){r.add(i);var a=[];if(o.children)for(var u=o.children,l=0,c=u.length;l<c;l++){var p=u[l];a.push(e(p,i,n,s))}return Promise.all(a)})}return function(r){var n=this.json,s=this.extensions,o=this.json.scenes[r],i=this,a=new se;o.name&&(a.name=this.createUniqueName(o.name)),N(a,o),o.extensions&&U(s,a,o);for(var u=o.nodes||[],l=[],c=0,p=u.length;c<p;c++)l.push(e(u[c],a,n,this));return Promise.all(l).then(function(){return a})}}(),W}();export{qt as GLTFLoader};
